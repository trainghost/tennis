<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>회원 목록 및 매칭</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <style>
        body {
            background-color: #f8f9fa; /* 밝은 회색 배경 */
            padding-top: 20px;
            padding-bottom: 20px;
        }
        .container {
            max-width: 1200px; /* 데스크톱에서 너무 넓어지는 것을 방지 */
        }
        .match-section {
            margin-bottom: 30px;
            padding: 20px;
            background-color: #ffffff; /* 흰색 배경 */
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,.08); /* 부드러운 그림자 */
        }
        .summary-card {
            border-left: 5px solid #007bff; /* 파란색 좌측 테두리 */
            border-radius: 5px;
            background-color: #e9f5ff; /* 연한 파란색 배경 */
            padding: 15px;
            margin-bottom: 20px;
        }
        .summary-card h5 {
            margin-bottom: 0;
            color: #0056b3;
        }
        .table-match-results th, .table-match-results td {
            text-align: center;
            vertical-align: middle;
            padding: 0.75rem; /* 셀 패딩 */
        }
        .table-match-results td:first-child {
            font-weight: bold;
            color: #495057;
        }
        .table-match-results thead th {
            background-color: #007bff;
            color: white;
            border-color: #007bff;
        }
        .table-match-results tbody tr:nth-of-type(odd) {
            background-color: rgba(0, 0, 0, 0.03);
        }
        .btn-success {
            background-color: #28a745;
            border-color: #28a745;
        }
        .btn-success:hover {
            background-color: #218838;
            border-color: #1e7e34;
        }
        .text-muted-small {
            font-size: 0.9em;
            color: #6c757d;
        }
        .non-selected-list {
            list-style: none;
            padding-left: 0;
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        .non-selected-list li {
            background-color: #e2e6ea;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 0.9em;
        }

        /* 미디어 쿼리: 작은 화면 (모바일) 최적화 */
        @media (max-width: 767.98px) {
            h2, h3, h4 {
                font-size: 1.5rem; /* 모바일에서 제목 크기 조정 */
            }
            .summary-card h5 {
                font-size: 1.1rem;
            }
            .table th, .table td {
                padding: 0.5rem; /* 모바일에서 테이블 셀 패딩 줄이기 */
                font-size: 0.9em; /* 모바일에서 텍스트 크기 조정 */
            }
            .form-control-sm {
                width: 70px; /* 순위 수정 입력란 너비 조정 */
            }
            .match-section {
                padding: 15px;
            }
            .table-match-results td:first-child {
                min-width: 80px; /* 코트명 컬럼 최소 너비 확보 */
            }
            .non-selected-list {
                flex-direction: column; /* 미선발자 목록 세로로 정렬 */
                gap: 5px;
            }
        }
    </style>
</head>
<body>
    <div class="container mt-5">
        <h2 class="mb-4 text-center text-primary">회원 목록 및 매칭 설정 📋</h2>

        <div class="match-section mb-5">
            <h3 class="mb-3 text-secondary">전체 회원 목록 (참여/순위 설정)</h3>
            <div class="alert alert-info" role="alert">
                참여할 회원을 선택하고, 필요시 순위를 수정해주세요. 
                <span class="d-block d-md-inline">매칭은 **'참여'에 체크된 회원들** 중에서 이루어집니다.</span>
            </div>
            <div class="table-responsive">
                <form action="/members" method="post" class="needs-validation" novalidate>
                    <table class="table table-hover table-striped caption-top">
                        <caption>* 순위를 수정하려면 숫자를 입력 후 '저장' 버튼을 누르세요.</caption>
                        <thead>
                            <tr>
                                <th>순위</th>
                                <th>이름</th>
                                <th>성별</th>
                                <th class="text-center">참여</th>
                                <th class="text-center">일퇴</th>
                                <th class="text-center">늦참</th>
                                <th>순위 수정</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for member in members %}
                            <tr>
                                <td>{{ member.순위 }}</td>
                                <td>{{ member.이름 }}</td>
                                <td>{{ member.성별 }}</td>
                                <td class="text-center">
                                    <div class="form-check">
                                        <input type="checkbox" class="form-check-input" name="participate_{{ member.이름 }}" id="participate_{{ member.이름 }}" {% if member.참여 %}checked{% endif %}>
                                        <label class="form-check-label visually-hidden" for="participate_{{ member.이름 }}">참여</label>
                                    </div>
                                </td>
                                <td class="text-center">
                                    <div class="form-check">
                                        <input type="checkbox" class="form-check-input" name="early_{{ loop.index0 }}" id="early_{{ loop.index0 }}" {% if member.일퇴 %}checked{% endif %}>
                                        <label class="form-check-label visually-hidden" for="early_{{ loop.index0 }}">일퇴</label>
                                    </div>
                                </td>
                                <td class="text-center">
                                    <div class="form-check">
                                        <input type="checkbox" class="form-check-input" name="late_{{ loop.index0 }}" id="late_{{ loop.index0 }}" {% if member.늦참 %}checked{% endif %}>
                                        <label class="form-check-label visually-hidden" for="late_{{ loop.index0 }}">늦참</label>
                                    </div>
                                </td>
                                <td>
                                    <input type="number" class="form-control form-control-sm" name="rank_{{ member.이름 }}" value="{{ member.순위 }}" min="1">
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                    <button type="submit" class="btn btn-success mt-3 w-100">선택 저장 및 매칭 결과 보기 ✅</button>
                </form>
            </div>
        </div>

        <hr class="my-5">
        <div class="match-section">
            <h3 class="mb-3 text-primary">🏆 매칭 1 결과 (코트 3, 4, 5)</h3>
            <div class="summary-card">
                <h5 class="card-title">요약: 총 {{ summary_1.total }}명 참여 (여자 {{ summary_1.female }}명 / 남자 {{ summary_1.male }}명)</h5>
            </div>

            {% if team_match_results_1 %}
            <h4 class="mb-3 text-center">매칭 1 대진표</h4>
            <div class="table-responsive">
                <table class="table table-bordered table-hover table-match-results">
                    <thead>
                        <tr>
                            <th>코트</th>
                            <th colspan="2">팀 A</th>
                            <th>vs</th>
                            <th colspan="2">팀 B</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for match in team_match_results_1 %}
                        <tr>
                            <td>{{ match.court }}</td>
                            <td>{{ match.team_a[0].이름 }} <span class="text-muted-small">({{ match.team_a[0].순위 }}위)</span></td>
                            <td>{{ match.team_a[1].이름 }} <span class="text-muted-small">({{ match.team_a[1].순위 }}위)</span></td>
                            <td></td> {# "vs"는 th에 있으므로 여기는 비워둠 #}
                            <td>{{ match.team_b[0].이름 }} <span class="text-muted-small">({{ match.team_b[0].순위 }}위)</span></td>
                            <td>{{ match.team_b[1].이름 }} <span class="text-muted-small">({{ match.team_b[1].순위 }}위)</span></td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <p class="text-muted text-center">매칭 1 대진표가 생성되지 않았습니다. (참여 인원 부족 또는 조건 불일치)</p>
            {% endif %}

            {% if non_selected_participants_1 %}
            <h5 class="mt-4 text-warning">매칭 1 미선발 참여자 🚧:</h5>
            <ul class="non-selected-list">
                {% for p in non_selected_participants_1 %}
                <li>{{ p.이름 }} ({{ p.순위 }}위)</li>
                {% endfor %}
            </ul>
            {% endif %}
        </div>

        <hr class="my-5">
        <div class="match-section">
            <h3 class="mb-3 text-primary">🥈 매칭 2 결과 (코트 3, 4, 5)</h3>
            <div class="summary-card">
                <h5 class="card-title">요약: 총 {{ summary_2.total }}명 참여 (여자 {{ summary_2.female }}명 / 남자 {{ summary_2.male }}명)</h5>
            </div>

            {% if team_match_results_2 %}
            <h4 class="mb-3 text-center">매칭 2 대진표</h4>
            <div class="table-responsive">
                <table class="table table-bordered table-hover table-match-results">
                    <thead>
                        <tr>
                            <th>코트</th>
                            <th colspan="2">팀 A</th>
                            <th>vs</th>
                            <th colspan="2">팀 B</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for match in team_match_results_2 %}
                        <tr>
                            <td>{{ match.court }}</td>
                            <td>{{ match.team_a[0].이름 }} <span class="text-muted-small">({{ match.team_a[0].순위 }}위)</span></td>
                            <td>{{ match.team_a[1].이름 }} <span class="text-muted-small">({{ match.team_a[1].순위 }}위)</span></td>
                            <td></td>
                            <td>{{ match.team_b[0].이름 }} <span class="text-muted-small">({{ match.team_b[0].순위 }}위)</span></td>
                            <td>{{ match.team_b[1].이름 }} <span class="text-muted-small">({{ match.team_b[1].순위 }}위)</span></td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <p class="text-muted text-center">매칭 2 대진표가 생성되지 않았습니다. (참여 인원 부족 또는 조건 불일치)</p>
            {% endif %}

            {% if non_selected_participants_2 %}
            <h5 class="mt-4 text-warning">매칭 2 미선발 참여자 🚧:</h5>
            <ul class="non-selected-list">
                {% for p in non_selected_participants_2 %}
                <li>{{ p.이름 }} ({{ p.순위 }}위)</li>
                {% endfor %}
            </ul>
            {% endif %}
        </div>

        <hr class="my-5">
        <div class="match-section">
            <h3 class="mb-3 text-primary">🥉 매칭 3 결과 (코트 3, 4, 5)</h3>
            <div class="summary-card">
                <h5 class="card-title">요약: 총 {{ summary_3.total }}명 참여 (여자 {{ summary_3.female }}명 / 남자 {{ summary_3.male }}명)</h5>
            </div>

            {% if team_match_results_3 %}
            <h4 class="mb-3 text-center">매칭 3 대진표</h4>
            <div class="table-responsive">
                <table class="table table-bordered table-hover table-match-results">
                    <thead>
                        <tr>
                            <th>코트</th>
                            <th colspan="2">팀 A</th>
                            <th>vs</th>
                            <th colspan="2">팀 B</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for match in team_match_results_3 %}
                        <tr>
                            <td>{{ match.court }}</td>
                            <td>{{ match.team_a[0].이름 }} <span class="text-muted-small">({{ match.team_a[0].순위 }}위)</span></td>
                            <td>{{ match.team_a[1].이름 }} <span class="text-muted-small">({{ match.team_a[1].순위 }}위)</span></td>
                            <td></td>
                            <td>{{ match.team_b[0].이름 }} <span class="text-muted-small">({{ match.team_b[0].순위 }}위)</span></td>
                            <td>{{ match.team_b[1].이름 }} <span class="text-muted-small">({{ match.team_b[1].순위 }}위)</span></td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <p class="text-muted text-center">매칭 3 대진표가 생성되지 않았습니다. (참여 인원 부족 또는 조건 불일치)</p>
            {% endif %}

            {% if non_selected_participants_3 %}
            <h5 class="mt-4 text-warning">매칭 3 미선발 참여자 🚧:</h5>
            <ul class="non-selected-list">
                {% for p in non_selected_participants_3 %}
                <li>{{ p.이름 }} ({{ p.순위 }}위)</li>
                {% endfor %}
            </ul>
            {% endif %}
        </div>

        <div class="text-center mt-5">
            <a href="/" class="btn btn-secondary">다시 파일 업로드 🔄</a>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
</body>
</html>
